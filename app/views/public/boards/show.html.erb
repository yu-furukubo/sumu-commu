<div class='container p-5 px-sm-0'>
  <div class='row'>
    <div class='col-md-10 offset-md-1'>
      <div class="ml-5 mb-3">
        <h2>掲示板詳細</h2>
      </div>
      <div class="container">
        <div class="offset-1">
          <table class='table table-borderless'>
            <% if @board.member_id == 0 %>
              <tr><th style="width: 20%">投降者名</th><td>管理人</td></tr>
            <% else %>
              <tr><th style="width: 20%">投降者名</th><td><%= @board.member.name %></td></tr>
            <% end %>
            <tr><th>件名</th><td><%= @board.name %></td></tr>
            <tr><th>本文</th><td><%= @board.body %></td></tr>
          </table>

          <% if @board.member_id == current_member.id %>
            <div class="row">
              <div class="mx-auto">
                <%= link_to "編集する", edit_public_board_path, class: "btn btn-success" %>&emsp;&emsp;
                <%= link_to "削除する", public_board_path, method: :delete,
                  data: {confirm:'本当に削除してよろしいですか？'}, class: "btn btn-danger" %>
              </div>
            </div>
          <% else %>
            <div class="row">
              <div class="mx-auto">
                <%= render 'public/boards/read', board: @board, read: @read %>
              </div>
            </div>
          <% end %>

          <!--回覧メンバー表示用の記述-->
          <% if @board.is_circular == true %>
            <div class="mt-3">
              <div class="row mb-3 d-flex align-items-center">
                <h4>回覧メンバー</h4>&emsp;
                <% if @board_checked_members.count == @circular_members.count && @circular_members.exists? %>
                  <span class="text-primary font-weight-bold">全員確認済</span>
                <% elsif @circular_members.count == 0 %>
                  <span>（回覧メンバーが設定されていません）</span>
                <% else %>
                  <span>&emsp;確認済：<%= @board_checked_members.count %>人（<%= @circular_members.count %>人中）</span>
                <% end %>
                <% if @board.member_id == current_member.id %>
                  <%= link_to ">>回覧メンバーを編集する", public_board_circular_members_path(@board), class: "text-success" %>
                <% end %>
              </div>
              <table class='table table-borderless'>
                <tbody>
                  <% @circular_members.each do |circular_member| %>
                    <tr>
                      <td style="width: 30%"><%= circular_member.member.name %></td>
                      <% if circular_member.is_checked == true %>
                        <td class="text-primary"><i class="fa-solid fa-check"></i></td>
                      <% else %>
                        <td class="text-secondary"><i class="fa-solid fa-xmark"></i></td>
                      <% end %>

                      <% if circular_member.id == current_member.id %>
                        <% if circular_member.is_checked == false %>
                          <%= form_with model:@circular_member, url: public_board_circular_member_path(@board, @circular_member), local: true do |f| %>
                            <%= f.hidden_field :is_checked, :value => true %>
                            <td><%= f.submit "確認済みにする", class: 'btn btn-sm btn-success' %></td>
                          <% end %>
                        <% else %>
                          <%= form_with model:@circular_member, url: public_board_circular_member_path(@board, @circular_member), local: true do |f| %>
                            <%= f.hidden_field :is_checked, :value => false %>
                            <td><%= f.submit "未確認に戻す", class: 'btn btn-sm btn-secondary' %></td>
                          <% end %>
                        <% end %>
                      <% end %>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          <% end %>
          <!--回覧メンバー表示用の記述ここまで-->

        </div>
      </div>
     </div>
  </div>
</div>